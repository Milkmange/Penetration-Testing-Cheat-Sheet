# Active Directory Certificate Services (ADCS) Petitpotam and ntlmrelayx to Domain Admin

# Background

I was on a recent engagement in a large AD environment of a large corporate business. There was a number of domain controllers, along with seperate ADCS servers used for signing and assigning certificates within the domain. This attack path used petitpotam (CVE-2021-36942) to coerce a domain controller within the active directory environment into authenticating with it's machine account - E.G DC1$ - to an attacker-controlled Kali Linux instance. Ntlmrelayx was then used to relay the machine account authentication to the ADCS server within the environment, in order to obtain a certificte for the domain controller machine account. This could then be used to either generate a kerberos ticket or to extract the machine account NTLM hash to dcsync a domain controller within the environment.
